# مدیریت حجم منطقی (LVM) در لینوکس

## 1. مفاهیم اصلی LVM


### فیزیکی (Physical Volume - PV):

این‌ها دیسک‌ها یا بخش‌هایی از دیسک هستند که LVM آن‌ها را به عنوان منابع ذخیره‌سازی پایه در نظر می‌گیرد. مثلاً یک هارد دیسک یا یک بخش از هارد دیسک.


### گروه حجم (Volume Group - VG):

یک گروه حجم مجموعه‌ای از فضاهای ذخیره‌سازی فیزیکی است که به صورت یک واحد منطقی در نظر گرفته می‌شود. این گروه به شما امکان می‌دهد فضای ذخیره‌سازی را به صورت یکپارچه مدیریت کنید.


### حجم منطقی (Logical Volume - LV):

این‌ها حجم‌هایی هستند که درون گروه حجم‌ها ایجاد می‌شوند و به مانند پارتیشن‌های معمولی استفاده می‌شوند. شما می‌توانید حجم‌های منطقی مختلفی با اندازه‌های متفاوت ایجاد کنید و این حجم‌ها می‌توانند به سیستم فایل‌ها یا برنامه‌های کاربردی مختلف اختصاص داده شوند.


## 2. مزایای استفاده از LVM

### انعطاف‌پذیری:
با LVM، می‌توانید حجم‌های منطقی را به راحتی افزایش یا کاهش دهید بدون نیاز به تغییر پارتیشن‌ها. این باعث می‌شود مدیریت فضای دیسک بسیار ساده‌تر شود.

### مدیریت آسان:  
شما می‌توانید فضای ذخیره‌سازی را از چندین دیسک فیزیکی ترکیب کنید و آن را به صورت یک واحد منطقی مدیریت کنید. این می‌تواند به ویژه در سرورها یا سیستم‌های بزرگ مفید باشد.

### ایجاد و حذف حجم‌ها:
  شما می‌توانید حجم‌های منطقی جدیدی ایجاد کنید یا حجم‌های قدیمی را حذف کنید بدون اینکه تأثیری بر روی سایر قسمت‌های سیستم داشته باشید.

### پشتیبان‌گیری و بازیابی:
  با استفاده از قابلیت‌هایی مانند "اسنپ‌شات" (Snapshot)، می‌توانید نسخه‌های پشتیبان از حجم‌های منطقی تهیه کنید و در صورت نیاز به بازیابی سریع، از آن‌ها استفاده کنید.
  





## 3. چگونگی کار با LVM

## ایجاد PV، VG، و LV:
  - ابتدا باید دیسک‌ها یا پارتیشن‌های فیزیکی را به عنوان PV معرفی کنید.
  - سپس یک VG با استفاده از PVها ایجاد کنید.
  - در نهایت، حجم‌های منطقی را درون VG ایجاد کنید.

## مدیریت فضای ذخیره‌سازی:
  - می‌توانید حجم‌های منطقی را بزرگ‌تر کنید یا فضای آن‌ها را کاهش دهید.
  - می‌توانید PVهای جدید را به VG اضافه کنید یا آن‌ها را حذف کنید.


## 4. فرایندهای اصلی LVM

### افزایش حجم منطقی:
  اگر فضای ذخیره‌سازی در یک حجم منطقی کم است، می‌توانید اندازه آن را افزایش دهید.
  
### کاهش حجم منطقی:  
  در صورتی که فضای ذخیره‌سازی نیاز به کاهش داشته باشد، می‌توانید حجم منطقی را کاهش دهید، البته باید قبل از کاهش حجم، مطمئن شوید که فضای آن به درستی مدیریت شده است.

### ایجاد اسنپ‌شات:
  برای گرفتن نسخه‌های پشتیبان از حجم‌های منطقی به طور موقت و سریع، می‌توانید از اسنپ‌شات‌ها استفاده کنید.



# دستورات LVM در لینوکس

## 1. **نصب LVM**

در ابتدا، ممکن است نیاز باشد که بسته‌های مورد نیاز برای LVM را نصب کنید. در اکثر توزیع‌های لینوکس، این کار با استفاده از مدیر بسته توزیع انجام می‌شود. برای مثال:

```bash
sudo apt-get update
sudo apt-get install lvm2
```

## 2. نصب پارتیشن به کمک دستور fdisk

## 3. تغییر پارتیشن ID به 8e:
fdisk /dev/sdx --> t --> 8e --> w

## 4. ایجاد Physical Volume (PV)


برای ایجاد یک PV از یک دیسک یا پارتیشن، از دستور pvcreate استفاده می‌کنیم:

```bash
sudo pvcreate /dev/sdX
```
جایگزین /dev/sdX با نام دیسک یا پارتیشن مورد نظر.
برای مشاهده PV:
```bash
pvs
```



## 5. ایجاد Volume Group (VG)
بعد از ایجاد PV، می‌توانید یک گروه حجم (VG) ایجاد کنید:



```bash
sudo vgcreate my_volume_group /dev/sdX
```
جایگزین my_volume_group با نام دلخواه برای گروه حجم و /dev/sdX با نام دیسک یا پارتیشن.
برای مشاهده VG:
```bash
vgs
```


## 6. ایجاد Logical Volume (LV)
برای ایجاد یک حجم منطقی (LV) در یک گروه حجم، از دستور lvcreate استفاده می‌کنیم:

```bash
sudo lvcreate -L 10G -n my_logical_volume my_volume_group
```

در اینجا:

-L 10G اندازه حجم منطقی را مشخص می‌کند (در اینجا 10 گیگابایت).

-n my_logical_volume نام حجم منطقی را تعیین می‌کند.

my_volume_group نام گروه حجم است.

برای مشاهده LV:
```bash
lvs
```



## 7. فرمت و مانت کردن Logical Volume

بعد از ایجاد حجم منطقی، باید آن را فرمت و سپس مانت کنید:

### فرمت کردن حجم منطقی:

```bash
sudo mkfs.ext4 /dev/my_volume_group/my_logical_volume
```

### مانت کردن حجم منطقی:
ابتدا باید یک دایرکتوری برای مانت کردن ایجاد کنید:
```bash
sudo mkdir /mnt/my_mount_point
```
سپس حجم منطقی را مانت کنید:

```bash
sudo mount /dev/my_volume_group/my_logical_volume /mnt/my_mount_point
```

بهتر است در برای ازبین نرفتن اطلاعات مانت ، این مقادیر را در fstab نیز ذخیره کنید .

## 6. مدیریت Logical Volume

### افزایش اندازه Logical Volume:
```bash
sudo lvextend -L +5G /dev/my_volume_group/my_logical_volume
```

سپس، سیستم فایل را با استفاده از دستور مناسب به روز کنید:

```bash
sudo resize2fs /dev/my_volume_group/my_logical_volume
```

### کاهش اندازه Logical Volume:
ابتدا باید سیستم فایل را کاهش دهید:

```bash
sudo resize2fs /dev/my_volume_group/my_logical_volume 8G
```
سپس حجم منطقی را کاهش دهید:

```bash
sudo lvreduce -L 8G /dev/my_volume_group/my_logical_volume
```

### حذف Logical Volume:
برای حذف یک حجم منطقی، ابتدا باید آن را غیرمانت کنید و سپس حذف کنید:

```bash
sudo umount /mnt/my_mount_point
sudo lvremove /dev/my_volume_group/my_logical_volume
```

### حذف Volume Group:
ابتدا باید همه حجم‌های منطقی را حذف کنید و سپس گروه حجم را حذف کنید:

```bash
sudo vgremove my_volume_group
```

### حذف Physical Volume:
برای حذف یک PV از گروه حجم:

```bash
sudo pvremove /dev/sdX
```

## 7. استفاده از Snapshots
ایجاد Snapshot:

```bash
sudo lvcreate -L 1G -s -n my_snapshot /dev/my_volume_group/my_logical_volume
```


